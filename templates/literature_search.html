{% extends "base.html" %}

{% block title %}ForgeLore — Literature Search{% endblock %}

{% block page_header %}
<div class="flex items-center justify-between">
  <div>
    <h1 class="text-xl font-semibold tracking-tight">Literature</h1>
    <p class="mt-1 text-sm text-gray-600">Search arXiv, DOAJ, Semantic Scholar, and OpenAlex.</p>
  </div>
</div>
{% endblock %}

{% block content %}
<form method="get" action="" class="rounded-lg border border-gray-200 bg-white p-4">
  {% csrf_token %}
  <div class="flex items-center gap-3">
    <label for="q" class="sr-only">Query</label>
    <input type="text" id="q" name="q" value="{{ query }}" placeholder="e.g. quantum error correction" class="w-full rounded-md border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:border-brand-600 focus:ring-brand-600">
    <input type="email" id="mailto" name="mailto" value="{{ request.GET.mailto }}" placeholder="mailto (optional)" class="w-64 rounded-md border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:border-brand-600 focus:ring-brand-600">
    <button type="submit" class="inline-flex items-center rounded-md bg-brand-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-brand-700">Search</button>
  </div>
</form>

{% if error %}
  <div class="mt-4 rounded-md border border-red-200 bg-red-50 text-sm text-red-700 p-3">{{ error }}</div>
{% endif %}

{% if results_by_source %}
  <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-4">
    {% for source, items in results_by_source.items %}
      <div class="rounded-lg border border-gray-200 bg-white p-4">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold uppercase tracking-wide text-gray-600">{{ source }}</h2>
          <span class="text-xs text-gray-500">{{ items|length }} results</span>
        </div>
        <div role="list" class="mt-3 space-y-3">
          {% for r in items %}
            <div role="listitem" class="text-sm">
              <div class="font-medium">{{ r.title }}</div>
              {% if r.authors %}
                <div class="text-gray-600">By {% for a in r.authors %}{% if not forloop.first %}, {% endif %}{{ a.name }}{% endfor %}</div>
              {% endif %}
              <div class="text-xs text-gray-500">
                {% if r.venue %}{{ r.venue }} · {% endif %}
                {% if r.year %}{{ r.year }} · {% endif %}
                {% if r.doi %}DOI: {{ r.doi }}{% endif %}
              </div>
              <div class="mt-1 flex items-center gap-3 text-xs">
                {% if r.url %}<a href="{{ r.url }}" target="_blank" class="text-brand-700 hover:underline">View</a>{% endif %}
                {% if r.open_access_pdf_url %}<a href="{{ r.open_access_pdf_url }}" target="_blank" class="text-brand-700 hover:underline">PDF</a>{% endif %}
              </div>
            </div>
          {% empty %}
            <div role="listitem" class="text-sm text-gray-500">No results</div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}


